# לוח תזמון אימונים חכם - Smart Schedule Grid

## סקירה כללית

תכונה חדשה המאפשרת לרכזים ולמנהלים לתזמן אימונים בצורה נוחה וויזואלית יותר באמצעות לוח זמנים אינטראקטיבי.

## תכונות עיקריות

### 1. **תצוגת לוח זמנים ויזואלית**
- הצגת כל המגרשים במערכת עם לוח השעות שלהם
- משבצות זמן של 1.5 שעות (90 דקות)
- תצוגה ברורה של משבצות פנויות ותפוסות
- צבעים מותאמים לכל קבוצה

### 2. **בחירת תאריך**
- בחירה חופשית של כל תאריך מלוח השנה
- כפתור מהיר למעבר להיום הנוכחי
- הצגת יום ותאריך בעברית

### 3. **תזמון אימונים בלחיצה אחת**
- לחיצה על משבצת פנויה פותחת דיאלוג לבחירת קבוצה
- בחירת קבוצה שומרת אוטומטית את האימון
- בדיקת התנגשויות אוטומטית
- סנכרון מיידי עם Firebase

### 4. **ניהול אימונים קיימים**
- לחיצה על משבצת תפוסה מציגה את פרטי האימון
- אפשרות למחיקת אימון ישירות מהלוח
- עדכונים בזמן אמת של כל השינויים

## מבנה הקבצים

### Models
- **`TimeSlot.java`** - מודל למשבצת זמן בלוח
  - מכיל: מגרש, שעת התחלה וסיום, תאריך, זמינות, אימון משויך

### Fragments
- **`ScheduleGridFragment.java`** - הפרגמנט הראשי של הלוח
  - ניהול בחירת תאריך
  - יצירת משבצות זמן לפי טווח השעות של כל מגרש
  - טיפול בלחיצות על משבצות
  - תזמון ומחיקת אימונים

### Adapters
- **`CourtScheduleAdapter.java`** - מתאם להצגת המגרשים והמשבצות
  - מציג רשימה של מגרשים
  - כל מגרש מכיל רשימה אופקית של משבצות זמן
  - תמיכה במגילה אופקית של משבצות

### Layouts
- **`fragment_schedule_grid.xml`** - Layout ראשי של הלוח
- **`item_court_schedule.xml`** - Layout לכל מגרש ברשימה
- **`item_time_slot.xml`** - Layout למשבצת זמן בודדת

## אלגוריתם יצירת משבצות זמן

```java
1. לכל מגרש במערכת:
   a. בדוק אם המגרש פעיל ביום הנבחר (לפי DaySchedule)
   b. אם כן, קבל את טווח השעות (פתיחה-סגירה)
   c. צור משבצות של 90 דקות מהפתיחה עד הסגירה
   d. סמן כתפוסות משבצות עם אימונים קיימים

2. עבור כל אימון קיים:
   a. בדוק אם האימון באותו יום ומגרש
   b. מצא את המשבצת המתאימה (לפי שעות)
   c. סמן אותה כתפוסה והצמד את פרטי האימון
```

## זרימת תזמון אימון חדש

```
1. משתמש לוחץ על משבצת פנויה
   ↓
2. מוצגת רשימת כל הקבוצות
   ↓
3. משתמש בוחר קבוצה
   ↓
4. המערכת בודקת התנגשויות
   ↓
5. אם אין התנגשות:
   - יוצר אימון חדש
   - שומר ב-Firebase
   - מעדכן את הלוח אוטומטית (LiveData)
   ↓
6. הצגת הודעת הצלחה
```

## אינטגרציה עם המערכת הקיימת

### Navigation
התוספת ל-`nav_graph.xml`:
```xml
<fragment
    android:id="@+id/scheduleGridFragment"
    android:name="com.example.testapp.fragments.ScheduleGridFragment"
    android:label="תזמון אימונים חכם"
    tools:layout="@layout/fragment_schedule_grid" />

<action
    android:id="@+id/action_home_to_scheduleGrid"
    app:destination="@id/scheduleGridFragment" />
```

### Home Fragment
- נוסף כרטיס "תזמון אימונים חכם" 🎯
- נראה לרכזים ומנהלים בלבד
- מנווט ל-`ScheduleGridFragment`

### Firebase Repository
- שימוש ב-`TrainingRepository` קיים
- נוסף ממשק `OnTrainingAddedListener` חדש
- תמיכה בהוספה פשוטה יותר של אימונים

## הרשאות גישה

| תפקיד | גישה ללוח תזמון |
|-------|----------------|
| **מנהל (ADMIN)** | ✅ גישה מלאה |
| **רכז (COORDINATOR)** | ✅ גישה מלאה |
| **מאמן (COACH)** | ❌ אין גישה |
| **שחקן (PLAYER)** | ❌ אין גישה |

## תכונות נוספות להמשך פיתוח

1. **סינון קבוצות בדיאלוג הבחירה**
   - חיפוש לפי שם קבוצה
   - סינון לפי גיל/רמה

2. **עריכת אימון**
   - אפשרות לשנות שעות/קבוצה
   - גרירת אימונים בין משבצות

3. **שכפול אימונים**
   - שכפול לשבוע הבא/חודש הבא
   - יצירת תבנית שבועית

4. **תצוגת שבוע מלא**
   - מעבר בין ימים בצורה זורמת
   - סליידר לשבוע הבא/קודם

5. **התראות והתנגשויות**
   - התראה ויזואלית על התנגשויות
   - הצעות לזמנים חלופיים

## טכנולוגיות בשימוש

- **RecyclerView** - תצוגת המגרשים והמשבצות
- **CardView** - עיצוב הכרטיסים
- **Material Design** - כפתורים ודיאלוגים
- **LiveData** - עדכונים בזמן אמת
- **Firebase Realtime Database** - אחסון ונתונים
- **Calendar API** - ניהול תאריכים ושעות

## בדיקות והרצה

1. התחבר כמשתמש עם הרשאות רכז/מנהל
2. במסך הבית, לחץ על "תזמון אימונים חכם" 🎯
3. בחר תאריך (ברירת מחדל: היום)
4. לחץ על משבצת פנויה (ירוקה)
5. בחר קבוצה מהרשימה
6. ודא שהאימון נשמר ומוצג בלוח
7. לחץ על המשבצת התפוסה לצפייה במידע
8. בדוק אפשרות מחיקה

## תיקון באגים ידועים

אם הלוח לא מציג משבצות:
1. ודא שיש מגרשים במערכת עם לוח שנה מוגדר
2. בדוק שהמגרש פעיל ביום הנבחר
3. ודא ש-`DaySchedule` מוגדר עם שעות תקינות

---

**תאריך יצירה:** ינואר 2026  
**גרסה:** 1.0  
**מפתח:** Basketball Training Management System
